{
  "hash": "3b03d41199ee979b512aee686f92083c",
  "result": {
    "markdown": "---\ntitle: \"In-Class Exercise 9: Geographically Weighted Predictive Model\"\nauthor: \"Emily Aurelia\"\nformat:\n  html:\n    toc-depth: 4\nexecute: \n  warning: false #to remove the warning in the webpage\n  freeze: True\ndate: \"18 March 2024\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, spdep, GWmodel, SpatialML, tmap, rsample, tidymodels, tidyverse, gtsummary, rpart, rpart.plot, ggstatsplot, performance)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrs_sf <- read_rds(\"data/rds/HDB_resale.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(rs_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 15,901\nColumns: 18\n$ RESALE_PRICE             <dbl> 330000, 360000, 370000, 375000, 380000, 38000…\n$ FLOOR_AREA_SQM           <dbl> 92, 91, 92, 99, 92, 92, 92, 92, 93, 91, 91, 9…\n$ STOREY_ORDER             <int> 1, 3, 1, 2, 2, 4, 3, 2, 4, 3, 3, 3, 4, 3, 2, …\n$ REMAINING_LEASE_MTHS     <dbl> 684, 738, 733, 700, 715, 732, 706, 745, 731, …\n$ PROX_CBD                 <dbl> 8.824749, 9.841309, 9.560780, 9.609731, 8.351…\n$ PROX_ELDERLYCARE         <dbl> 0.2514065, 0.6318448, 1.0824168, 0.3473195, 0…\n$ PROX_HAWKER              <dbl> 0.44182653, 0.26972560, 0.25829513, 0.4364751…\n$ PROX_MRT                 <dbl> 0.6885144, 1.0969096, 0.8862859, 1.4093169, 0…\n$ PROX_PARK                <dbl> 0.7450859, 0.4294870, 0.7800777, 0.1776163, 0…\n$ PROX_GOOD_PRISCH         <dbl> 1.2703931, 0.4045792, 2.0942375, 0.1375070, 1…\n$ PROX_MALL                <dbl> 0.5534331, 1.0677012, 0.9751113, 1.1752392, 1…\n$ PROX_CHAS                <dbl> 1.364596e-01, 2.569863e-01, 1.906189e-01, 2.9…\n$ PROX_SUPERMARKET         <dbl> 0.2708222, 0.3101889, 0.3187560, 0.4586748, 0…\n$ WITHIN_350M_KINDERGARTEN <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, …\n$ WITHIN_350M_CHILDCARE    <int> 6, 5, 2, 3, 3, 2, 3, 4, 3, 2, 4, 4, 4, 5, 2, …\n$ WITHIN_350M_BUS          <int> 8, 8, 8, 7, 6, 9, 6, 6, 5, 4, 10, 5, 6, 9, 8,…\n$ WITHIN_1KM_PRISCH        <int> 2, 2, 1, 2, 2, 1, 3, 2, 2, 2, 2, 2, 3, 2, 2, …\n$ geometry                 <POINT [m]> POINT (29179.92 38822.08), POINT (28423…\n```\n:::\n:::\n\nSplit the train and test data into a 50-50 ratio\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nresale_split <- initial_split(rs_sf, prop=5/10) #will do random sampling, if strata = TRUE, then it is stratified sampling\ntrain_sf <- training(resale_split)\ntest_sf <- testing(resale_split)\n```\n:::\n\nYou can save the train and test data as rds and then read it again to save memory space\n\nThe models in SpatialML only receives data frames as input, so we need to convert the spatial data into data frames\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_df <- train_sf |> st_drop_geometry() |> as.data.frame()\n\ntest_df <- test_sf |> st_drop_geometry() |> as.data.frame()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrs_sf1 <- rs_sf |> st_drop_geometry()\nggcorrmat(rs_sf1[,2:17])\n```\n\n::: {.cell-output-display}\n![](In-Class-Exercise-9_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_df <- train_df |> select(-c(PROX_CHAS))\ntrain_sf <- train_sf |> select(-c(PROX_CHAS))\ntest_df <- test_df |> select(-c(PROX_CHAS))\ntest_sf <- test_sf |> select(-c(PROX_CHAS))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrs_mlr <- lm(formula = RESALE_PRICE ~ .,\n                data=train_df)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl_regression(rs_mlr, intercept=TRUE)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"picinvvobf\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#picinvvobf table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#picinvvobf thead, #picinvvobf tbody, #picinvvobf tfoot, #picinvvobf tr, #picinvvobf td, #picinvvobf th {\n  border-style: none;\n}\n\n#picinvvobf p {\n  margin: 0;\n  padding: 0;\n}\n\n#picinvvobf .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#picinvvobf .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#picinvvobf .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#picinvvobf .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#picinvvobf .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#picinvvobf .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#picinvvobf .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#picinvvobf .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#picinvvobf .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#picinvvobf .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#picinvvobf .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#picinvvobf .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#picinvvobf .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#picinvvobf .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#picinvvobf .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#picinvvobf .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#picinvvobf .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#picinvvobf .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#picinvvobf .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#picinvvobf .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#picinvvobf .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#picinvvobf .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#picinvvobf .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#picinvvobf .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#picinvvobf .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#picinvvobf .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#picinvvobf .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#picinvvobf .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#picinvvobf .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#picinvvobf .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#picinvvobf .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#picinvvobf .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#picinvvobf .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#picinvvobf .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#picinvvobf .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#picinvvobf .gt_left {\n  text-align: left;\n}\n\n#picinvvobf .gt_center {\n  text-align: center;\n}\n\n#picinvvobf .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#picinvvobf .gt_font_normal {\n  font-weight: normal;\n}\n\n#picinvvobf .gt_font_bold {\n  font-weight: bold;\n}\n\n#picinvvobf .gt_font_italic {\n  font-style: italic;\n}\n\n#picinvvobf .gt_super {\n  font-size: 65%;\n}\n\n#picinvvobf .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#picinvvobf .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#picinvvobf .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#picinvvobf .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#picinvvobf .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#picinvvobf .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#picinvvobf .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Characteristic&lt;/strong&gt;\"><strong>Characteristic</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Beta&lt;/strong&gt;\"><strong>Beta</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;95% CI&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><strong>95% CI</strong><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;p-value&lt;/strong&gt;\"><strong>p-value</strong></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">(Intercept)</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">105,081</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">81,622, 128,540</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">FLOOR_AREA_SQM</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">2,791</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">2,589, 2,992</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">STOREY_ORDER</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">14,038</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">13,286, 14,789</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">REMAINING_LEASE_MTHS</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">346</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">335, 356</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_CBD</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-17,907</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-18,422, -17,392</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_ELDERLYCARE</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-14,588</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-16,783, -12,392</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_HAWKER</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-17,434</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-20,247, -14,621</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_MRT</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-31,752</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-35,590, -27,914</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_PARK</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-9,366</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-12,708, -6,023</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_GOOD_PRISCH</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">2,758</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">2,008, 3,508</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_MALL</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-12,220</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-16,674, -7,765</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">PROX_SUPERMARKET</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-28,049</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-37,298, -18,800</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">WITHIN_350M_KINDERGARTEN</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">8,722</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">7,312, 10,131</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">WITHIN_350M_CHILDCARE</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-4,515</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-5,295, -3,735</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">WITHIN_350M_BUS</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">1,084</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">590, 1,578</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">WITHIN_1KM_PRISCH</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-8,201</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-9,285, -7,117</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><0.001</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"4\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span> CI = Confidence Interval</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n:::\n:::\n\n\n\nextract out the coordinates to be used for the coordinates pair for the grf.bw() function\n\n::: {.cell}\n\n```{.r .cell-code}\ncoords <- st_coordinates(rs_sf)\ncoords_train <- st_coordinates(train_sf)\ncoords_test <- st_coordinates(test_sf)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nrs_rp <- rpart(formula = RESALE_PRICE ~ ., data = train_df)\n\nrs_rp\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nn= 7950 \n\nnode), split, n, deviance, yval\n      * denotes terminal node\n\n 1) root 7950 1.139546e+14 433705.6  \n   2) PROX_CBD>=7.974483 6665 4.472144e+13 403736.0  \n     4) REMAINING_LEASE_MTHS< 1020.5 4228 1.573100e+13 370187.4  \n       8) PROX_GOOD_PRISCH>=3.629405 2271 3.851141e+12 340796.1 *\n       9) PROX_GOOD_PRISCH< 3.629405 1957 7.641480e+12 404294.6 *\n     5) REMAINING_LEASE_MTHS>=1020.5 2437 1.597594e+13 461940.1  \n      10) PROX_CBD>=10.40657 2331 9.762718e+12 451754.4  \n        20) PROX_GOOD_PRISCH>=4.866983 1123 2.801796e+12 423493.8 *\n        21) PROX_GOOD_PRISCH< 4.866983 1208 5.230246e+12 478026.4 *\n      11) PROX_CBD< 10.40657 106 6.532500e+11 685929.1 *\n   3) PROX_CBD< 7.974483 1285 3.219685e+13 589151.4  \n     6) REMAINING_LEASE_MTHS< 930.5 745 6.613365e+12 486637.6  \n      12) FLOOR_AREA_SQM< 98.5 451 2.446537e+12 442460.5 *\n      13) FLOOR_AREA_SQM>=98.5 294 1.936449e+12 554405.7 *\n     7) REMAINING_LEASE_MTHS>=930.5 540 6.952722e+12 730582.5  \n      14) REMAINING_LEASE_MTHS< 1071.5 314 2.461969e+12 676641.3 *\n      15) REMAINING_LEASE_MTHS>=1071.5 226 2.307737e+12 805527.4 *\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrpart.plot(rs_rp)\n```\n\n::: {.cell-output-display}\n![](In-Class-Exercise-9_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nrs_rf <- ranger(formula = RESALE_PRICE ~ ., data = train_df, importance = \"impurity\")\nrs_rf\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRanger result\n\nCall:\n ranger(formula = RESALE_PRICE ~ ., data = train_df, importance = \"impurity\") \n\nType:                             Regression \nNumber of trees:                  500 \nSample size:                      7950 \nNumber of independent variables:  15 \nMtry:                             3 \nTarget node size:                 5 \nVariable importance mode:         impurity \nSplitrule:                        variance \nOOB prediction error (MSE):       738005688 \nR squared (OOB):                  0.9485198 \n```\n:::\n:::\n\nTo extract the feature importance\n\n::: {.cell}\n\n```{.r .cell-code}\nvi <- as.data.frame(rs_rf$variable.importance)\nvi$variables <- rownames(vi)\nvi <- vi |> rename(vi = \"rs_rf$variable.importance\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data=vi, aes(x = vi, y = reorder(variables, vi))) +\n  geom_bar(stat = \"identity\") #treat every column as single observation\n```\n\n::: {.cell-output-display}\n![](In-Class-Exercise-9_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = vi) +\n  geom_col(aes(x = vi, y = reorder(variables, vi)))\n```\n\n::: {.cell-output-display}\n![](In-Class-Exercise-9_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n\nThe above graph shows that the model work well with the variables provided. However, if the model cannot utilize the variables, your model might suffer from quasi-separation or quasi complete separation problem. This is a problem where the model cannot differentiate between the two classes of the dependent variable. This is a common problem in logistic regression, but it can also happen in other models. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrf_pred <- read_rds(\"data/models/grf_pred.rds\")\ngrf_pred_df <- as.data.frame(grf_pred)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_pred <- test_df |> select(RESALE_PRICE) |> cbind(grf_pred_df)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrf_pred <- predict(rs_rf, test_df)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrf_pred_df <- as.data.frame(rf_pred$predictions) |> rename(rf_pred = \"rf_pred$predictions\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_pred <- test_pred |> cbind(rf_pred_df)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmlr_pred <- predict(rs_mlr, test_df)\nmlr_pred_df <- as.data.frame(mlr_pred) |> rename(mlr_pred = \"mlr_pred\")\ntest_pred <- cbind(test_pred, mlr_pred_df)\n```\n:::\n\n\nto comparison between the models\n\n::: {.cell}\n\n```{.r .cell-code}\nmc <- test_pred |> pivot_longer(cols=c(2:4),\n                                names_to = \"models\",\n                                values_to = \"predicted\")\n```\n:::\n\n\noutput table to do comparison of the models using the RMSE\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc |> group_by(models) |> yardstick::rmse(RESALE_PRICE, predicted)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 4\n  models   .metric .estimator .estimate\n  <chr>    <chr>   <chr>          <dbl>\n1 grf_pred rmse    standard      28745.\n2 mlr_pred rmse    standard      61617.\n3 rf_pred  rmse    standard      28348.\n```\n:::\n:::\n\nfrom the output, random forest outperform the multi regression model. The basic non geographic random forest model is better than the geographic random forest model. such that in this use casem just use the rf model because it runs faster than the grf. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = test_pred,\n       aes(x = grf_pred,\n           y=RESALE_PRICE)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](In-Class-Exercise-9_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = test_pred,\n       aes(x = mlr_pred,\n           y=RESALE_PRICE)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](In-Class-Exercise-9_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\nThe outlier is quite big for multiple linear regression such that it has higher rmse than the grf. \n\n\n\n\n\n\n\n\n\n",
    "supporting": [
      "In-Class-Exercise-9_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}